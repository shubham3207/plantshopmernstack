function cov_2dqubeb5m9(){var path="/Users/shubham/Downloads/backend_florashop-2/middleware/auth.js";var hash="bfcefbab3a0bb287f47001863367b2a0bce7d0f9";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/shubham/Downloads/backend_florashop-2/middleware/auth.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:53}},"1":{start:{line:3,column:25},end:{line:3,column:54}},"2":{start:{line:5,column:12},end:{line:5,column:35}},"3":{start:{line:7,column:13},end:{line:7,column:43}},"4":{start:{line:10,column:0},end:{line:20,column:3}},"5":{start:{line:11,column:20},end:{line:11,column:31}},"6":{start:{line:12,column:2},end:{line:14,column:3}},"7":{start:{line:13,column:4},end:{line:13,column:67}},"8":{start:{line:15,column:22},end:{line:15,column:63}},"9":{start:{line:17,column:2},end:{line:17,column:49}},"10":{start:{line:19,column:2},end:{line:19,column:9}},"11":{start:{line:23,column:0},end:{line:32,column:1}},"12":{start:{line:24,column:2},end:{line:31,column:3}},"13":{start:{line:25,column:4},end:{line:29,column:5}},"14":{start:{line:26,column:6},end:{line:28,column:8}},"15":{start:{line:30,column:4},end:{line:30,column:11}},"16":{start:{line:34,column:0},end:{line:52,column:2}},"17":{start:{line:37,column:2},end:{line:37,column:69}},"18":{start:{line:38,column:21},end:{line:38,column:46}},"19":{start:{line:39,column:2},end:{line:39,column:26}},"20":{start:{line:40,column:2},end:{line:42,column:3}},"21":{start:{line:41,column:4},end:{line:41,column:74}},"22":{start:{line:43,column:16},end:{line:43,column:40}},"23":{start:{line:44,column:2},end:{line:51,column:3}},"24":{start:{line:45,column:24},end:{line:45,column:65}},"25":{start:{line:46,column:4},end:{line:46,column:51}},"26":{start:{line:47,column:4},end:{line:47,column:11}},"27":{start:{line:49,column:4},end:{line:49,column:23}},"28":{start:{line:50,column:4},end:{line:50,column:73}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:10,column:47},end:{line:10,column:48}},loc:{start:{line:10,column:73},end:{line:20,column:1}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:23,column:26},end:{line:23,column:27}},loc:{start:{line:23,column:40},end:{line:32,column:1}},line:23},"2":{name:"(anonymous_2)",decl:{start:{line:24,column:9},end:{line:24,column:10}},loc:{start:{line:24,column:29},end:{line:31,column:3}},line:24},"3":{name:"(anonymous_3)",decl:{start:{line:34,column:15},end:{line:34,column:16}},loc:{start:{line:34,column:41},end:{line:52,column:1}},line:34}},branchMap:{"0":{loc:{start:{line:12,column:2},end:{line:14,column:3}},type:"if",locations:[{start:{line:12,column:2},end:{line:14,column:3}},{start:{line:12,column:2},end:{line:14,column:3}}],line:12},"1":{loc:{start:{line:25,column:4},end:{line:29,column:5}},type:"if",locations:[{start:{line:25,column:4},end:{line:29,column:5}},{start:{line:25,column:4},end:{line:29,column:5}}],line:25},"2":{loc:{start:{line:40,column:2},end:{line:42,column:3}},type:"if",locations:[{start:{line:40,column:2},end:{line:42,column:3}},{start:{line:40,column:2},end:{line:42,column:3}}],line:40},"3":{loc:{start:{line:40,column:6},end:{line:40,column:53}},type:"binary-expr",locations:[{start:{line:40,column:6},end:{line:40,column:17}},{start:{line:40,column:21},end:{line:40,column:53}}],line:40}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"bfcefbab3a0bb287f47001863367b2a0bce7d0f9"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2dqubeb5m9=function(){return actualCoverage;};}return actualCoverage;}cov_2dqubeb5m9();const ErrorHandler=(cov_2dqubeb5m9().s[0]++,require("../utils/ErrorHandler"));const catchAsyncErrors=(cov_2dqubeb5m9().s[1]++,require("./catchAsyncErrors"));const jwt=(cov_2dqubeb5m9().s[2]++,require("jsonwebtoken"));const User=(cov_2dqubeb5m9().s[3]++,require("../models/UserModel"));cov_2dqubeb5m9().s[4]++;exports.isAuthenticatedUser=catchAsyncErrors(async(req,res,next)=>{cov_2dqubeb5m9().f[0]++;const{token}=(cov_2dqubeb5m9().s[5]++,req.cookies);cov_2dqubeb5m9().s[6]++;if(!token){cov_2dqubeb5m9().b[0][0]++;cov_2dqubeb5m9().s[7]++;return next(new ErrorHandler("Please login to continue",401));}else{cov_2dqubeb5m9().b[0][1]++;}const decodedData=(cov_2dqubeb5m9().s[8]++,jwt.verify(token,process.env.JWT_SECRET));cov_2dqubeb5m9().s[9]++;req.user=await User.findById(decodedData.id);cov_2dqubeb5m9().s[10]++;next();});// admin roles here
cov_2dqubeb5m9().s[11]++;exports.authorizedRoles=(...roles)=>{cov_2dqubeb5m9().f[1]++;cov_2dqubeb5m9().s[12]++;return(req,res,next)=>{cov_2dqubeb5m9().f[2]++;cov_2dqubeb5m9().s[13]++;if(!roles.includes(req.user.role)){cov_2dqubeb5m9().b[1][0]++;cov_2dqubeb5m9().s[14]++;return next(new ErrorHandler(`${req.user.role} are not authorized to perform this action`,403));}else{cov_2dqubeb5m9().b[1][1]++;};cov_2dqubeb5m9().s[15]++;next();};};cov_2dqubeb5m9().s[16]++;exports.auth=async(req,res,next)=>{cov_2dqubeb5m9().f[3]++;cov_2dqubeb5m9().s[17]++;// check header
console.log("---------------------------------------------------");const authHeader=(cov_2dqubeb5m9().s[18]++,req.headers.authorization);cov_2dqubeb5m9().s[19]++;console.log(authHeader);cov_2dqubeb5m9().s[20]++;if((cov_2dqubeb5m9().b[3][0]++,!authHeader)||(cov_2dqubeb5m9().b[3][1]++,!authHeader.startsWith("Bearer"))){cov_2dqubeb5m9().b[2][0]++;cov_2dqubeb5m9().s[21]++;return next(new ErrorHandler("Please login to access the data",400));}else{cov_2dqubeb5m9().b[2][1]++;}const token=(cov_2dqubeb5m9().s[22]++,authHeader.split(" ")[1]);cov_2dqubeb5m9().s[23]++;try{const decodedData=(cov_2dqubeb5m9().s[24]++,jwt.verify(token,process.env.JWT_SECRET));cov_2dqubeb5m9().s[25]++;req.user=await User.findById(decodedData.id);cov_2dqubeb5m9().s[26]++;next();}catch(error){cov_2dqubeb5m9().s[27]++;console.log(error);cov_2dqubeb5m9().s[28]++;throw next(new ErrorHandler("Please login to access the data",400));}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMmRxdWJlYjVtOSIsImFjdHVhbENvdmVyYWdlIiwiRXJyb3JIYW5kbGVyIiwicyIsInJlcXVpcmUiLCJjYXRjaEFzeW5jRXJyb3JzIiwiand0IiwiVXNlciIsImV4cG9ydHMiLCJpc0F1dGhlbnRpY2F0ZWRVc2VyIiwicmVxIiwicmVzIiwibmV4dCIsImYiLCJ0b2tlbiIsImNvb2tpZXMiLCJiIiwiZGVjb2RlZERhdGEiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsInVzZXIiLCJmaW5kQnlJZCIsImlkIiwiYXV0aG9yaXplZFJvbGVzIiwicm9sZXMiLCJpbmNsdWRlcyIsInJvbGUiLCJhdXRoIiwiY29uc29sZSIsImxvZyIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInN0YXJ0c1dpdGgiLCJzcGxpdCIsImVycm9yIl0sInNvdXJjZXMiOlsiYXV0aC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBFcnJvckhhbmRsZXIgPSByZXF1aXJlKFwiLi4vdXRpbHMvRXJyb3JIYW5kbGVyXCIpO1xuXG5jb25zdCBjYXRjaEFzeW5jRXJyb3JzID0gcmVxdWlyZShcIi4vY2F0Y2hBc3luY0Vycm9yc1wiKTtcblxuY29uc3Qgand0ID0gcmVxdWlyZShcImpzb253ZWJ0b2tlblwiKTtcblxuY29uc3QgVXNlciA9IHJlcXVpcmUoXCIuLi9tb2RlbHMvVXNlck1vZGVsXCIpO1xuXG5cbmV4cG9ydHMuaXNBdXRoZW50aWNhdGVkVXNlciA9IGNhdGNoQXN5bmNFcnJvcnMoYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGNvbnN0IHsgdG9rZW4gfSA9IHJlcS5jb29raWVzO1xuICBpZiAoIXRva2VuKSB7XG4gICAgcmV0dXJuIG5leHQobmV3IEVycm9ySGFuZGxlcihcIlBsZWFzZSBsb2dpbiB0byBjb250aW51ZVwiLCA0MDEpKTtcbiAgfVxuICBjb25zdCBkZWNvZGVkRGF0YSA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuXG4gIHJlcS51c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChkZWNvZGVkRGF0YS5pZCk7XG5cbiAgbmV4dCgpO1xufSk7XG5cbi8vIGFkbWluIHJvbGVzIGhlcmVcbmV4cG9ydHMuYXV0aG9yaXplZFJvbGVzID0gKC4uLnJvbGVzKSA9PiB7XG4gIHJldHVybiAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICBpZiAoIXJvbGVzLmluY2x1ZGVzKHJlcS51c2VyLnJvbGUpKSB7XG4gICAgICByZXR1cm4gbmV4dChcbiAgICAgICAgbmV3IEVycm9ySGFuZGxlcihgJHtyZXEudXNlci5yb2xlfSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gcGVyZm9ybSB0aGlzIGFjdGlvbmAsIDQwMylcbiAgICAgICk7XG4gICAgfTtcbiAgICBuZXh0KCk7XG4gIH1cbn1cblxuZXhwb3J0cy5hdXRoID0gYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIC8vIGNoZWNrIGhlYWRlclxuXG4gIGNvbnNvbGUubG9nKFwiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCIpO1xuICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbjtcbiAgY29uc29sZS5sb2coYXV0aEhlYWRlcik7XG4gIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKFwiQmVhcmVyXCIpKSB7XG4gICAgcmV0dXJuIG5leHQobmV3IEVycm9ySGFuZGxlcihcIlBsZWFzZSBsb2dpbiB0byBhY2Nlc3MgdGhlIGRhdGFcIiwgNDAwKSk7XG4gIH1cbiAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnNwbGl0KFwiIFwiKVsxXTtcbiAgdHJ5IHtcbiAgICBjb25zdCBkZWNvZGVkRGF0YSA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuICAgIHJlcS51c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChkZWNvZGVkRGF0YS5pZCk7XG4gICAgbmV4dCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICB0aHJvdyBuZXh0KG5ldyBFcnJvckhhbmRsZXIoXCJQbGVhc2UgbG9naW4gdG8gYWNjZXNzIHRoZSBkYXRhXCIsIDQwMCkpO1xuICB9XG59O1xuIl0sIm1hcHBpbmdzIjoiOHZIQWVZO0FBQUFBLGNBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsY0FBQSxHQWZaLEtBQU0sQ0FBQUUsWUFBWSxFQUFBRixjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLHVCQUF1QixDQUFDLEVBRXJELEtBQU0sQ0FBQUMsZ0JBQWdCLEVBQUFMLGNBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsRUFFdEQsS0FBTSxDQUFBRSxHQUFHLEVBQUFOLGNBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsY0FBYyxDQUFDLEVBRW5DLEtBQU0sQ0FBQUcsSUFBSSxFQUFBUCxjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLHFCQUFxQixDQUFDLEVBQUNKLGNBQUEsR0FBQUcsQ0FBQSxNQUc1Q0ssT0FBTyxDQUFDQyxtQkFBbUIsQ0FBR0osZ0JBQWdCLENBQUMsTUFBT0ssR0FBRyxDQUFFQyxHQUFHLENBQUVDLElBQUksR0FBSyxDQUFBWixjQUFBLEdBQUFhLENBQUEsTUFDdkUsS0FBTSxDQUFFQyxLQUFNLENBQUMsRUFBQWQsY0FBQSxHQUFBRyxDQUFBLE1BQUdPLEdBQUcsQ0FBQ0ssT0FBTyxFQUFDZixjQUFBLEdBQUFHLENBQUEsTUFDOUIsR0FBSSxDQUFDVyxLQUFLLENBQUUsQ0FBQWQsY0FBQSxHQUFBZ0IsQ0FBQSxTQUFBaEIsY0FBQSxHQUFBRyxDQUFBLE1BQ1YsTUFBTyxDQUFBUyxJQUFJLENBQUMsR0FBSSxDQUFBVixZQUFZLENBQUMsMEJBQTBCLENBQUUsR0FBRyxDQUFDLENB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